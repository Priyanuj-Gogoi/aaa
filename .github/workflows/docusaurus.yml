name: Docusaurus
on:
  push:
    branches:
       - prod
  #  paths-ignore:
    #   - '.github/**'

jobs:
  validate:
    name: Validate Environment Secret
    runs-on: ubuntu-latest
    outputs:
        git_pass: ${{ steps.git-pass.outputs.valid }}
    env:
        valid: ${{ secrets.TOKEN }}
    steps:
       - name: Success
         id: git-pass
         if: env.valid != ''
         run: echo "::set-output name=valid::true"
       - name: Failed
         if: env.valid == ''
         run: |
            echo "::error title=Missing secret!::Failed to get TOKEN environment secret!"
            exit 1

  deploy:
    name: Deployment
    runs-on: ubuntu-latest
    needs: [validate]
    env:
       GIT_USER: $GITHUB_ACTOR
       GIT_PASS: ${{ secrets.TOKEN }}
    steps:
       - name: Checkout Repository
         uses: actions/checkout@v3
       - name: Setup Node
         uses: actions/setup-node@v3.5.1
         with:
            node-version: 18
            cache: 'yarn'
       - name: Install Packages
         run: yarn --frozen-lockfile
       - name: Deploy to GitHub Pages
         run: |
            git config --global user.name "github-actions[bot]"
            git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
            yarn deploy
